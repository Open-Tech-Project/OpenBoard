## موجز
- الهدف: إزالة بالكامل واجهة وقواعد "قائمة التخطيط السريع"، وربط التبديل بين التخطيطات/اللغات بمفتاح المسافة فقط، مع الاعتماد الحصري على التخطيطات/اللغات المفعّلة من صفحة الإعدادات.
- ملاحظة منصّية: المشروع HarmonyOS/ArkUI وليس Android؛ عبارة "API 19" لا تنطبق مباشرة. سنلتزم بأحدث واجهات ArkUI/HarmonyOS المستخدمة في المشروع ونتأكد من التوافق عبر الإصدارات المعلّمة في ملفات البناء.

## ما سنحذفه
- الحالة وواجهة القائمة المنبثقة:
  - حذف `@State showLanguageSheet` من `entry/src/main/ets/InputMethodExtensionAbility/pages/Index.ets:174–177`.
  - حذف كتلة العرض الخاصة بالورقة المنبثقة: `Index.ets:316–363`.
- مسار الضغط المطوّل على المسافة:
  - حذف خاصية `onSpaceLongPress` من `KeyView` وتعطيل استدعائها: التعريف عند `Index.ets:66–69`، والاستدعاء داخل منطق الضغط المطوّل عند `Index.ets:133–142`، وتمريرها في البناء عند `Index.ets:285–294`.

## ربط التبديل بمفتاح المسافة
- الإبقاء على التبديل عبر السحب الأفقي على زر المسافة (قائم): `Index.ets:295–301`، ومنطق التدوير: `Index.ets:260–273`.
- المنطق يعتمد على `availableLanguages` القادمة من صفحة الإعدادات: القراءة والتخزين `Index.ets:179–215`.
- النتيجة: التبديل يستجيب فقط للغات/التخطيطات المفعّلة من الإعدادات.

## تحسينات التوافق والمعايير
- الحفاظ على إدراج المسافة عند النقر القصير: `Index.ets:238–241`.
- تعزيز معالجة الأخطاء:
  - عند فشل قراءة التفضيلات، تسجيل خطأ والرجوع إلى `'en'`: `Index.ets:211–214`.
  - التحقق من أن `availableLanguages.length > 1` قبل التبديل: `Index.ets:261–263`.
- التوافق عبر الإصدارات: لا استخدام لواجهات غير مدعومة؛ نعتمد `@ohos.data.preferences` وArkUI الحالية كما في المشروع.

## الاختبارات
- تحديث/إضافة اختبارات Hypium:
  - اختبار دوران اللغات في `handleSwipe` لضمان التدوير فقط ضمن `enabled_languages`.
  - اختبار حالات: قائمة واحدة، قائمة فارغة (رجوع تلقائي إلى `'en'`).
  - يمكن توسيع اختبار الوحدة الموجود: `entry/src/test/QuickSwitchLogic.test.ets` للتحقق من الحدود.

## مخاطر وحالات حدّية
- عند وجود لغة واحدة فقط: السحب لن يبدّل؛ يتم إدراج المسافة فقط.
- عند قراءة قائمة فارغة أو لغة غير مفعّلة كلغة حالية: يتم الضبط إلى `'en'`.
- اختلاف حساسية السحب أفقياً بين الأجهزة؛ سيتم الإبقاء على عتبة الزاوية الحالية.

## التسليم
- تنفيذ الحذف والتعديلات في `Index.ets`، والتأكد من عمل التبديل بالسحب على المسافة ضمن اللغات المفعّلة.
- تشغيل اختبارات الوحدة والتحقق اليدوي عبر تفعيل/تعطيل اللغات في الإعدادات.

## مراجع الشيفرة
- مفتاح المسافة وعرض اسم اللغة: `entry/src/main/ets/InputMethodExtensionAbility/pages/Index.ets:88–99, 238–241`.
- السحب والتدوير: `Index.ets:260–273, 295–301`.
- قراءة التفضيلات وربط `availableLanguages`: `Index.ets:179–215`.
- الإعدادات/التفضيلات: `entry/src/main/ets/pages/SettingsPage.ets:23–63, 75–101`.

## طلب الموافقة
- عند الموافقة، سأحذف كل ما يتعلق بالقائمة السريعة، وأثبت التبديل بالسحب على مفتاح المسافة فقط ضمن التخطيطات المفعّلة من الإعدادات، وأحدث الاختبارات وفقًا لذلك.